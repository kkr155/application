import{d as D,r as n,o as B,c as o,b as l,i as E,a as u,j as L,u as F,p as M,w as R,k as w,F as h,f as S,l as _,v as g,t as p,E as A,h as s,_ as N}from"./index-DlVvhxd0.js";import{D as $,_ as K}from"./Dialog-C6w6rde9.js";import{s as b}from"./request-Ckln7nig.js";const q=()=>b({url:"/pgyer/configs",method:"get"}),P=d=>b({url:"/pgyer/addConfig",method:"post",data:d}),j=d=>b({url:`/pgyer/deleteConfig/${d}`,method:"delete"}),I=d=>b({url:"https://api.pgyer.com/apiv2/app/check",method:"post",data:new URLSearchParams(Object.entries(d)).toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"}}),T={class:"form-group"},z={class:"form-group"},O={class:"form-group"},G=["disabled"],H={class:"user-management"},J={class:"user-list"},Q={key:0,class:"loading"},W={key:1,class:"empty-state"},X={key:2},Y={class:"user-info"},Z={class:"name"},ee={key:0,class:"minor"},te={key:1,class:"minor"},le={key:2,class:"detail"},ae=["onClick"],se=["onClick","disabled"],oe=D({__name:"PgyerManageView",setup(d){const c=n(!1),f=n(!1),m=n(null),y=n(!1),r=n([]),i=n({config_id:0,name:"",apikey:"",appkey:""}),v=n(null),k=async()=>{try{f.value=!0,m.value=null;const a=await q();r.value=a.data;for(const t of r.value){const e=await I({_api_key:t.apikey,appKey:t.appkey});console.log("配置数据:",e),e.code==0&&(t.buildBuildVersion=e.data.buildBuildVersion,t.downloadURL=e.data.downloadURL,t.buildVersion=e.data.buildVersion,t.buildVersionNo=e.data.buildVersionNo,t.buildUpdateDescription=e.data.buildUpdateDescription,t.buildFileKey=e.data.buildFileKey)}}catch(a){m.value="获取用户列表失败",console.error("Error fetching users:",a)}finally{f.value=!1}},C=async()=>{try{y.value=!0;const a=await P(i.value);a.code==200?(c.value=!1,i.value={config_id:0,name:"",apikey:"",appkey:""},await k()):A.error(a.message)}catch(a){console.error("Error Add User:",a),m.value="添加用户失败"}finally{y.value=!1}},V=async a=>{if(confirm("确定要删除这个用户吗？"))try{v.value=a,await j(a),r.value=r.value.filter(t=>t.config_id!==a)}catch(t){m.value="删除用户失败",console.error("Error deleting user:",t)}finally{v.value=null}},U=(a,t="app.apk")=>{const e=document.createElement("a");e.href=a,e.download=t,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)};return B(()=>{k()}),(a,t)=>(s(),o(h,null,[l("button",{class:"fixed-toggle",onClick:t[0]||(t[0]=e=>c.value=!0)},[L(F(M))]),c.value?(s(),E($,{key:0,onClick:t[4]||(t[4]=w(e=>c.value=!1,["self"]))},{default:R(()=>[t[8]||(t[8]=l("h2",null,"添加新配置",-1)),l("form",{onSubmit:w(C,["prevent"])},[l("div",T,[t[5]||(t[5]=l("label",{for:"name"},"应用名称",-1)),_(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.value.name=e),type:"text",id:"name",required:""},null,512),[[g,i.value.name]])]),l("div",z,[t[6]||(t[6]=l("label",{for:"apikey"},"apikey",-1)),_(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.apikey=e),type:"text",id:"apikey",required:""},null,512),[[g,i.value.apikey]])]),l("div",O,[t[7]||(t[7]=l("label",{for:"appkey"},"appkey",-1)),_(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.value.appkey=e),type:"text",id:"appkey",required:""},null,512),[[g,i.value.appkey]])]),l("button",{class:"add-btn",type:"submit",disabled:y.value},p(y.value?"提交中...":"添加配置"),9,G)],32)]),_:1})):u("",!0),l("div",H,[l("div",J,[t[11]||(t[11]=l("h2",null,"配置列表",-1)),f.value?(s(),o("div",Q,"加载中...")):r.value.length===0?(s(),o("div",W,[t[9]||(t[9]=l("img",{src:K,alt:"无数据",width:"120"},null,-1)),t[10]||(t[10]=l("p",null,"暂无用户数据",-1)),l("button",{onClick:k},"刷新数据")])):(s(),o("ul",X,[(s(!0),o(h,null,S(r.value,e=>(s(),o("li",{key:e.config_id,class:"user-item"},[l("div",Y,[l("span",Z,p(e.name),1),e.buildBuildVersion!=null&&e.buildBuildVersion.trim()!==""?(s(),o("span",ee,"蒲公英构建版本："+p(e.buildBuildVersion),1)):u("",!0),e.buildUpdateDescription!=null&&e.buildUpdateDescription.trim()!==""?(s(),o("span",te,"构建表述")):u("",!0),e.buildUpdateDescription!=null&&e.buildUpdateDescription.trim()!==""?(s(),o("span",le,p(e.buildUpdateDescription),1)):u("",!0),e.downloadURL!=null&&e.downloadURL.trim()!==""?(s(),o("button",{key:3,class:"add-btn",onClick:x=>U(e.downloadURL,e.buildFileKey??"yuxinzhihui.apk")}," 下载 ",8,ae)):u("",!0)]),l("button",{onClick:x=>V(e.config_id),class:"delete-btn",disabled:v.value===e.config_id},p(v.value===e.config_id?"删除中...":"删除"),9,se)]))),128))]))])])],64))}}),re=N(oe,[["__scopeId","data-v-5849b4d3"]]);export{re as default};
