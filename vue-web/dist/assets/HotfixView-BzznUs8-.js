import{d as T,f as r,c as k,a as t,g as l,w as o,h as H,i as u,o as V,u as x,j as N,b as f,k as P,t as h,l as j,E as q,_ as I}from"./index-Cm63ummC.js";const Z={class:"upload-container"},A={key:0,class:"success-result"},G={class:"result-details"},K={key:1,class:"error-result"},L=T({__name:"HotfixView",setup(O){const i=r({version:"",describe:""}),M=r({version:[{required:!0,message:"请输入版本号",trigger:"blur"},{pattern:/^v\d+\.\d+\.\d+$/,message:"格式如：v1.0.0",trigger:"blur"}],describe:[{required:!0,message:"请输入版本描述",trigger:"blur"},{min:10,message:"至少10个字符",trigger:"blur"}]}),F=r(),d=r([]),w=r(!1),v=r(!1),c=r(!1),_=r({filename:"",size:0,path:""}),g=r(""),b=r(),z=(a,e)=>{d.value=[a]},C=a=>{if(a===0)return"0 Bytes";const e=1024,p=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(a)/Math.log(e));return`${parseFloat((a/Math.pow(e,s)).toFixed(2))} ${p[s]}`},B=async()=>{if(b.value)try{if(await b.value.validate(),d.value.length===0){q.error("请选择上传文件");return}await D()}catch(a){console.error("表单验证出错:",a)}},D=async()=>{var e,p;w.value=!0;const a=new FormData;a.append("version",i.value.version),a.append("describe",i.value.describe),(e=d.value[0])!=null&&e.raw&&a.append("file",d.value[0].raw);try{const s=await fetch("http://192.168.31.197:5000/upload_hotfix",{method:"POST",body:a});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();n.status==="success"?(c.value=!0,_.value={filename:((p=d.value[0])==null?void 0:p.name)||"",size:n.size||0,path:n.path||""}):(c.value=!1,g.value=n.error||"上传失败")}catch(s){c.value=!1,s instanceof Error?g.value=s.message||"网络错误":g.value="未知错误"}finally{w.value=!1,v.value=!0}},E=()=>{var a,e;(a=b.value)==null||a.resetFields(),(e=F.value)==null||e.clearFiles(),d.value=[]};return(a,e)=>{const p=u("el-input"),s=u("el-form-item"),n=u("el-icon"),S=u("el-upload"),y=u("el-button"),U=u("el-form"),$=u("el-link"),R=u("el-dialog");return V(),k("div",Z,[e[14]||(e[14]=t("h2",null,"热修复包上传",-1)),l(U,{ref_key:"uploadForm",ref:b,model:i.value,rules:M.value,"label-width":"120px",class:"upload-form",onSubmit:H(B,["prevent"])},{default:o(()=>[l(s,{label:"版本号",prop:"version"},{default:o(()=>[l(p,{modelValue:i.value.version,"onUpdate:modelValue":e[0]||(e[0]=m=>i.value.version=m),placeholder:"例如：v1.0.1",clearable:""},null,8,["modelValue"])]),_:1}),l(s,{label:"版本描述",prop:"describe"},{default:o(()=>[l(p,{modelValue:i.value.describe,"onUpdate:modelValue":e[1]||(e[1]=m=>i.value.describe=m),type:"textarea",rows:3,placeholder:"请描述本次热修复的内容",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"热修复文件",prop:"file"},{default:o(()=>[l(S,{ref_key:"uploadRef",ref:F,class:"upload-demo",drag:"","auto-upload":!1,"on-change":z,"file-list":d.value,limit:1,accept:".zip,.rar,.7z,.png,.apk","show-file-list":!0},{default:o(()=>[l(n,{class:"el-icon--upload"},{default:o(()=>[l(x(N))]),_:1}),e[4]||(e[4]=t("div",{class:"el-upload__text"},[f(" 将文件拖到此处，或"),t("em",null,"点击上传"),t("br"),t("span",{class:"el-upload__tip"},"支持ZIP/RAR/7Z格式，大小不超过100MB")],-1))]),_:1},8,["file-list"])]),_:1}),l(s,null,{default:o(()=>[l(y,{type:"primary",loading:w.value,onClick:B},{default:o(()=>e[5]||(e[5]=[f(" 提交上传 ")])),_:1},8,["loading"]),l(y,{onClick:E},{default:o(()=>e[6]||(e[6]=[f("重置")])),_:1})]),_:1})]),_:1},8,["model","rules"]),l(R,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=m=>v.value=m),title:"上传结果",width:"30%",center:""},{footer:o(()=>[l(y,{type:"primary",onClick:e[2]||(e[2]=m=>v.value=!1)},{default:o(()=>e[13]||(e[13]=[f("确定")])),_:1})]),default:o(()=>[c.value?(V(),k("div",A,[l(n,{class:"success-icon"},{default:o(()=>[l(x(P))]),_:1}),e[11]||(e[11]=t("h3",null,"上传成功！",-1)),t("div",G,[t("p",null,[e[7]||(e[7]=t("strong",null,"文件名：",-1)),f(h(_.value.filename),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"文件大小：",-1)),f(h(C(_.value.size)),1)]),t("p",null,[e[10]||(e[10]=t("strong",null,"下载链接：",-1)),l($,{type:"primary",href:_.value.path,target:"_blank"},{default:o(()=>e[9]||(e[9]=[f(" 点击下载 ")])),_:1},8,["href"])])])])):(V(),k("div",K,[l(n,{class:"error-icon"},{default:o(()=>[l(x(j))]),_:1}),e[12]||(e[12]=t("h3",null,"上传失败",-1)),t("p",null,h(g.value),1)]))]),_:1},8,["modelValue"])])}}}),Q=I(L,[["__scopeId","data-v-3d5aa83b"]]);export{Q as default};
